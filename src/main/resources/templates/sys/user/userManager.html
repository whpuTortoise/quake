<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />


<title>用户管理</title>
<meta name="keywords" content="" />
<meta name="description" content="" />

<link rel="shortcut icon" href="favicon.ico" />
<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" />
<link th:href="@{/css/font-awesome.min.css}" rel="stylesheet" />

<link th:href="@{/css/plugins/bootstrap-table/bootstrap-table.min.css}" rel="stylesheet" />
<link th:href="@{/css/plugins/sweetalert/sweetalert.css}" rel="stylesheet"/>

<link th:href="@{/css/animate.min.css}" rel="stylesheet" />
<link th:href="@{/css/style.min.css}" rel="stylesheet" />

</head>

<body class="gray-bg">
	<div class="wrapper wrapper-content animated fadeInRight">
		<div class="row">
			<div class="col-sm-12">
				<div class="ibox float-e-margins">
					<div class="ibox-title">
						<form id="queryForm"  role="form" class="m-t">
                            <div class="panel panel-default">
							    <div class="panel-heading">
							        查询条件
							    </div>
							    <div class="panel-body form-group" style="margin-bottom:0px;">
							        <label class="col-sm-1 control-label" style="text-align: right; margin-top:5px">用户名：</label>
							        <div class="col-sm-2">
							            <input type="text" class="form-control" name="searchUserName" id="searchUserName"/>
							        </div>
							        <label class="col-sm-1 control-label" style="text-align: right; margin-top:5px">电话：</label>
							        <div class="col-sm-2">
							            <input type="text" class="form-control" name="searchTel"  id="searchTel" />
							        </div>
							        <div class="col-sm-1">
							            <button class="btn btn-primary" id="search_btn" type="button"><i class="fa fa-search"></i> 查询</button>
							        </div>
							        <div class="col-sm-1">
							            <button class="btn btn-white reset" type="reset"><i class="fa fa-refresh"></i> 重置</button>
							        </div>
							     </div>
							</div>
                        </form>
					</div>
					
					<div class="ibox-content">
                        
						<table id="mytab" class="table table-hover"></table>
						
						<div id="toolbar" class="btn-group pull-right">
						      <button id="btn_add" type="button" class="btn btn-primary"  style="margin-right: 2px;" >
						          <i class="fa fa-plus"></i> 新增
						      </button>
						      <button id="btn_delete" type="button" class="btn btn-primary" style="margin-right: 2px;">
						          <i class="fa fa-remove"></i> 批量删除
						      </button>
						      <button id="btn_export" type="button" class="btn btn-primary" >
						          <i class="fa fa-sign-in"></i> 导出
						      </button>
						 </div>

					</div>
				</div>
			</div>
		</div>

	</div>
	
	<div class="modal inmodal fade" id="editModal" tabindex="-1" role="dialog"  aria-hidden="true">
                 <div class="modal-dialog modal-lg">
                     <div class="modal-content">
                         <div class="modal-header">
                             <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button>
                             <h4 class="modal-title" id="modelTitle">窗口标题</h4>
                         </div>
                         <div class="modal-body">
          <form id="addForm" method="post" class="form-horizontal" >
          	<input type="hidden" class="form-control" name="id"  id="id"  />
              <div class="form-group">
                  <label class="col-sm-2 control-label">用户名</label>
                  <div class="col-sm-10">
                      <input type="text" class="form-control" name="username"  id="username" />
                  </div>
              </div>
              <div class="hr-line-dashed"></div>
              <div class="form-group">
                  <label class="col-sm-2 control-label">姓名</label>
                  <div class="col-sm-10">
                      <input type="text" class="form-control" name="realName"  id="realName"/>
                  </div>
              </div>
              <div class="hr-line-dashed"></div>
              <div class="form-group">
                  <label class="col-sm-2 control-label">手机号</label>
                  <div class="col-sm-10">
                      <input type="text" class="form-control" name="tel"  id="tel"/>
                  </div>
              </div>
              <div class="hr-line-dashed"></div>
              <div class="form-group">
                  <label class="col-sm-2 control-label">年龄</label>
                  <div class="col-sm-10">
                      <input type="text" class="form-control" name="age" id="age"  />
                  </div>
              </div>
          </form>
                         </div>

                         <div class="modal-footer">
                             <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
                             <button type="button" class="btn btn-primary" id="save">保存</button>
                         </div>
                     </div>
                 </div>
             </div>
	
	
	
	
	
	
	<script th:src="@{/js/jquery.min.js}"></script>
	<script th:src="@{/js/bootstrap.min.js}"></script>
	<script th:src="@{/js/plugins/bootstrap-table/bootstrap-table.min.js}"></script>
	<script th:src="@{/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js}"></script>
	<script th:src="@{/js/content.min.js}"></script>
	<script th:src="@{/js/plugins/sweetalert/sweetalert.min.js}"></script>
	<script>
	$(document).ready(function() {
		window.operateEvents = {
		         'click .editItem': function (e, value, row, index) {
		        	//清空输入框
						$("#addForm").find('input[type=text],select,input[type=hidden]').each(function() {
							$(this).val('');
						});
		        	 
		         	$("#modelTitle").html("编辑用户");
		         	$("#id").val(row.id);
		         	$("#username").val(row.username);
		           	$("#realName").val(row.realName); 
		           	$("#age").val(row.age);
		           	$("#tel").val(row.tel);
		            $('#editModal').modal();
		         },
		         'click .removeItem': function (e, value, row, index) {
		        	 swal({
				            title: "您确定要删除这条信息吗",
				            text: "删除后将无法恢复，请谨慎操作！",
				            type: "warning",
				            showCancelButton: true,
				            confirmButtonColor: "#DD6B55",
				            confirmButtonText: "删除",
				            cancelButtonText: "取消",
				            closeOnConfirm: true
				        }, function () {
				        	$.post("/user/deleteUsers",
				        			{ids:row.id},
				        			function(data){
				        				if(data=="success"){
				        					//刷新列表
											initTable();
				        				}
				        	});
				        });
		         }
		     };
		
		//根据窗口调整表格高度
	    $(window).resize(function() {
	        $('#mytab').bootstrapTable('resetView');
	    })
	    
	    initTable();
	    
	    function initTable(){
	    	//生成用户数据
	    	$("#mytab").bootstrapTable('destroy'); 
	    	    $('#mytab').bootstrapTable({
	    	        method: 'post',
	    	        contentType: "application/x-www-form-urlencoded",
	    	        url:"/user/getUserList",
	    	        queryParams:queryParams, //请求服务器时所传的参数
	    	        striped: true, //是否显示行间隔色
	    	        dataField: "rows", //数据列表字段
	    	        sidePagination:'server', //指定服务器端分页
	    	        pagination:true, //是否分页
	    	        pageNumber: 1, //初始化加载第一页
	    	        pageSize:10, //单页记录数
	    	        pageList:[5,10,20,30],//分页步进值
	    	        showColumns:true,
	    	        clickToSelect: true,//是否启用点击选中行
	    	        uniqueId: "id",
	    	        toolbarAlign:'left',//工具栏对齐方式
	    	        buttonsAlign:'right',//按钮对齐方式
	    	        toolbar:'#toolbar',//指定工作栏
	    	        columns:[
	    	            {
	    	                checkbox:true, //复选框
	    	                width:25,
	    	                align:'center',
	    	                valign:'middle'
	    	            },
	    	            {
	    	                title:'用户名',
	    	                field:'username'
	    	            },
	    	            {
	    	                title:'姓名',
	    	                field:'realName'
	    	            },
	    	            {
	    	                title:'年龄',
	    	                field:'age'
	    	            },
	    	            {
	    	                title:'电话',
	    	                field:'tel'
	    	            },
	    	            {
	    	                title:'创建日期',
	    	                field:'createTime'
	    	            }, 
	    	            {
	    	                title:'操作',
	    	                field:'id',
	    	                align:'center',
	    	                events:operateEvents,
	    	                formatter:operateFormatter //列数据格式化
	    	            }
	    	        ],
	    	        locale:'zh-CN',//中文支持,
	    	        responseHandler:function(res){
	    	            //在ajax获取到数据，渲染表格之前，修改数据源
	    	            return res;
	    	        }
	    	    });
		}
	
	    //三个参数，value代表该列的值
	    function operateFormatter(value,row,index){
	    	return [
					          '<a class="editItem" href="javascript:void(0)" title="编辑">',
					             '<i class="fa fa-pencil-square-o"></i>',
					             '</a>  ',
					         '<a class="removeItem" href="javascript:void(0)" title="删除">',
					         '<i class="glyphicon glyphicon-remove"></i>',
					         '</a>'
					     	].join('');
	    }
	    
	    

	    //请求服务数据时所传参数
	    function queryParams(params){
	    	var formData = $("#queryForm").serializeArray();//把form里面的数据序列化成数组
            formData.forEach(function (e) {
            	params[e.name] = e.value;
            });
             return params;//自定义需要传递的参数。
	    }
	     //查询按钮事件
	    $('#search_btn').click(function(){
	    	initTable();
	    })
	    
	    //tableHeight函数
	    function tableHeight(){
	        //可以根据自己页面情况进行调整
	        return $(window).height() -280;
	    }
		
	    //保存按钮事件
	    $('#save').click(function(){
	    	 var _info = $('#addForm').serialize();
	    	  $.post(
					"/user/saveUser",
					$('#addForm').serialize(),
					function(data){
						//后台返回添加成功
						if(data=="success"){
							//关闭弹窗
							$('#editModal').modal('hide'); 
							
							//刷新列表
							initTable();
						}
					}
				) 
	    })
	    
	    //新增
	    $('#btn_add').click(function () {
	    	//清空输入框
			$("#addForm").find('input[type=text],select,input[type=hidden]').each(function() {
				$(this).val('');
			});
	    	$("#modelTitle").html("新增用户");
            $('#editModal').modal();
	    });
	    
	    
	    //表格顶部的删除按钮
	    $('#btn_delete').click(function () {
	    	var dataArr=$('#mytab').bootstrapTable('getSelections');
	    	if(dataArr.length>=1){
	    		swal({
		            title: "您确定要删除这条信息吗",
		            text: "删除后将无法恢复，请谨慎操作！",
		            type: "warning",
		            showCancelButton: true,
		            confirmButtonColor: "#DD6B55",
		            confirmButtonText: "删除",
		            cancelButtonText: "取消",
		            closeOnConfirm: true
		        }, function () {
		        	var ids="";
		        	for(var i=dataArr.length-1; i>=0; i--){
		        		if(ids==""){
		        			ids=dataArr[i].id;
		        		}else{
		        			ids+=","+dataArr[i].id;
		        		}
		        	}
		        	$.post("/user/deleteUsers",
		        			{ids:ids},
		        			function(data){
		        				if(data=="success"){
		        					//刷新列表
									initTable();
		        				}
		        	});
		        });
	    	}else{
	    		swal("友情提示！", "请选择要删除的记录。", "warning");
	    	}
	        
	    });
	        
	    
	    
	    });  
    </script>
    </body>

    </html>